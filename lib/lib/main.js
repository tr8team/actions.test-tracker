class App {
    constructor(io, input, service) {
        this.#io = io;
        this.#input = input;
        this.#service = service;
    }
    #io;
    #input;
    #service;
    start() {
        return this.#input
            .retrieve()
            .andThen((inputs) => this.#service.store(inputs))
            .exec((r) => {
            this.#io.setObject("current", r.current);
            if (r.preImage)
                this.#io.setObject("before", r.preImage);
            if (r.afterImage)
                this.#io.setObject("after", r.afterImage);
            if (r.base)
                this.#io.setObject("base", r.base);
        })
            .err();
    }
}
export { App };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvbWFpbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFLQSxNQUFNLEdBQUc7SUFDUCxZQUFZLEVBQVksRUFBRSxLQUFxQixFQUFFLE9BQXdCO1FBQ3ZFLElBQUksQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO1FBQ2QsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDcEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUM7SUFDMUIsQ0FBQztJQUNELEdBQUcsQ0FBVztJQUNkLE1BQU0sQ0FBaUI7SUFDdkIsUUFBUSxDQUFrQjtJQUUxQixLQUFLO1FBQ0gsT0FBTyxJQUFJLENBQUMsTUFBTTthQUNmLFFBQVEsRUFBRTthQUNWLE9BQU8sQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDaEQsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDVixJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3pDLElBQUksQ0FBQyxDQUFDLFFBQVE7Z0JBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN6RCxJQUFJLENBQUMsQ0FBQyxVQUFVO2dCQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDNUQsSUFBSSxDQUFDLENBQUMsSUFBSTtnQkFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2pELENBQUMsQ0FBQzthQUNELEdBQUcsRUFBRSxDQUFDO0lBQ1gsQ0FBQztDQUNGO0FBRUQsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5wdXRSZXRyaWV2ZXIgfSBmcm9tIFwiLi9pbnRlcmZhY2UvaW5wdXQtcmV0cmlldmVyLmpzXCI7XG5pbXBvcnQgeyBBY3Rpb25JTyB9IGZyb20gXCIuL2ludGVyZmFjZS9pby5qc1wiO1xuaW1wb3J0IHsgSUhpc3RvcnlTZXJ2aWNlIH0gZnJvbSBcIi4vc2VydmljZS5qc1wiO1xuaW1wb3J0IHsgT3B0aW9uIH0gZnJvbSBcIi4vY29yZS9vcHRpb24uanNcIjtcblxuY2xhc3MgQXBwIHtcbiAgY29uc3RydWN0b3IoaW86IEFjdGlvbklPLCBpbnB1dDogSW5wdXRSZXRyaWV2ZXIsIHNlcnZpY2U6IElIaXN0b3J5U2VydmljZSkge1xuICAgIHRoaXMuI2lvID0gaW87XG4gICAgdGhpcy4jaW5wdXQgPSBpbnB1dDtcbiAgICB0aGlzLiNzZXJ2aWNlID0gc2VydmljZTtcbiAgfVxuICAjaW86IEFjdGlvbklPO1xuICAjaW5wdXQ6IElucHV0UmV0cmlldmVyO1xuICAjc2VydmljZTogSUhpc3RvcnlTZXJ2aWNlO1xuXG4gIHN0YXJ0KCk6IE9wdGlvbjxFcnJvcj4ge1xuICAgIHJldHVybiB0aGlzLiNpbnB1dFxuICAgICAgLnJldHJpZXZlKClcbiAgICAgIC5hbmRUaGVuKChpbnB1dHMpID0+IHRoaXMuI3NlcnZpY2Uuc3RvcmUoaW5wdXRzKSlcbiAgICAgIC5leGVjKChyKSA9PiB7XG4gICAgICAgIHRoaXMuI2lvLnNldE9iamVjdChcImN1cnJlbnRcIiwgci5jdXJyZW50KTtcbiAgICAgICAgaWYgKHIucHJlSW1hZ2UpIHRoaXMuI2lvLnNldE9iamVjdChcImJlZm9yZVwiLCByLnByZUltYWdlKTtcbiAgICAgICAgaWYgKHIuYWZ0ZXJJbWFnZSkgdGhpcy4jaW8uc2V0T2JqZWN0KFwiYWZ0ZXJcIiwgci5hZnRlckltYWdlKTtcbiAgICAgICAgaWYgKHIuYmFzZSkgdGhpcy4jaW8uc2V0T2JqZWN0KFwiYmFzZVwiLCByLmJhc2UpO1xuICAgICAgfSlcbiAgICAgIC5lcnIoKTtcbiAgfVxufVxuXG5leHBvcnQgeyBBcHAgfTtcbiJdfQ==